<h1 align="center">ì¢‹ì•„í•˜ë©´ ëˆ„ë¥´ëŠ”</h1>

<h1 align="center" style="max-width: 100%;">
  <img width="1100" alt="Logo" src="README.assets/title.png" style="max-width: 100%;" /><br/>
</h1>

<table>
  <tbody>
    <tr>
      <td><img width="500" src="README.assets/1.gif" alt="ë©”ì¸í™”ë©´"></td>
      <td><img width="500" src="README.assets/2.gif" alt="í•˜íŠ¸ì†¡ìˆ˜ì‹ "></td?>
    </tr>
    <tr>
      <td><img width="500" src="README.assets/3.gif" alt="ì±„íŒ…"></td>
      <td><img width="500" src="README.assets/4.gif" alt="ì´ëª¨ì§€ë³€ê²½"></td>
    </tr>
  </tbody>
</table>


<br>

<p align="center">
  <b>Supported</b><br/>
  <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/1200px-React-icon.svg.png" alt="react" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="README.assets/java.png" alt="java" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://perfectacle.github.io/2017/08/02/Spring-boot-study-001day/thumb.png" alt="springboot" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://t1.daumcdn.net/cfile/tistory/991A86475C91BE1D40" alt="jpa" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="https://media.vlpt.us/images/ec532/post/bc893d61-4eaa-4f8f-9b2c-e2d2143506a4/aws_ec2.svg" alt="EC2" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Kubernetes_logo_without_workmark.svg/1200px-Kubernetes_logo_without_workmark.svg.png" alt="kube" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://perfectacle.github.io/2019/04/16/spring-boot-docker-image-optimization/thumb.png" alt="docker" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Jenkins_logo.svg/1200px-Jenkins_logo.svg.png" alt="jenkins" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="https://blog.kakaocdn.net/dn/rrEfB/btq97aMSAsX/lstil1pt0KJW0Iy2WPO0Mk/img.png" alt="nginx" /></a>&nbsp;&nbsp;
  <a href="#"><img width="45" src="README.assets/mysql.png" alt="mysql" /></a>&nbsp;&nbsp;
    <a href="#"><img width="45" src="README.assets/mongo.png" alt="mongo" />

<br>



## ğŸŒˆ ê°œìš”

### ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰

ì›¹ : www.someone-might-like-you.com

ì•ˆë“œë¡œì´ë“œ : https://play.google.com/store/apps/details?id=com.cupid.joalarm

ì•„ì´í° : https://play.google.com/store/apps/details?id=com.nianticlabs.pokemongo

<br>

<table style="table-layout: fixed; overflow-wrap: break-word;">
  <tbody>
    <tr>
      <td colspan="2"><a href="#" target="_blank"><img width="1000" src="README.assets/promotion.gif" alt="Parallax demo" style="max-width: 100%;" /></a></td>
    </tr>
  </tbody>
</table>
<h1 align="center" >
   ìµëª… ì†ì—ì„œ ì„¤ë ˜ì„
</h1>
<h3 align="center">
  <br>
  ì£¼ë³€ 100m ì´ë‚´ì˜ ì‚¬ìš©ìë“¤ì€ ì„œë¡œì˜ ìœ„ì¹˜ë¥¼ ê³µìœ í•©ë‹ˆë‹¤. <br><br>
  í•˜íŠ¸ë¥¼ ì†¡ìˆ˜ì‹  í•  ìˆ˜ ìˆìœ¼ë©°, í•˜íŠ¸ê°€ ë§¤ì¹­ëœ ì‚¬ìš©ìë“¤ì€ 1:1 ì±„íŒ…ì´ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. <br><br>
  ì´ëª¨ì§€ ë³€ê²½, ìœ ì € ì‹ ê³  ë“± ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
</h3>

<br>

## ğŸ«§ Release History

<h3 align="center">
  22.05.21 - ì•±ìŠ¤í† ì–´ ì¶œì‹œ</h3>

<h3 align="center">
  22.05.20 - í”Œë ˆì´ìŠ¤í† ì–´ ì¶œì‹œ</h3>

<h3 align="center">
  22.05.13 - Web 2ì°¨ ë°°í¬</h3>  <h5  align="center">ì•ˆë‚´ í…œí”Œë¦¿ <br> ê±´ì˜í•¨ <br> ìœ„ì¹˜ ì—‘ì„¸ìŠ¤ í—ˆìš© ì•ˆë‚´ <br> ì´ëª¨ì§€ ë³€ê²½ <br></h5>
<h3 align="center">
  22.05.06 - Web MVP ìµœì´ˆ ë°°í¬</h3>
 <h5  align="center"> ì‚¬ìš©ìê°„ ìœ„ì¹˜ ê³µìœ  <br> í•˜íŠ¸ ì†¡ìˆ˜ì‹  <br> ì±„íŒ… <br> ìœ ì € ì‹ ê³  <br></h5>

<br>

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### **Front-end**

| <img src="https://profilinator.rishav.dev/skills-assets/html5-original-wordmark.svg" alt="HTML5" width="50px" height="50px" /> | <img src="https://profilinator.rishav.dev/skills-assets/css3-original-wordmark.svg" alt="CSS3" width="50px" height="50px" /> | <img src="https://profilinator.rishav.dev/skills-assets/javascript-original.svg" alt="TypeScript" width="50px" height="50px" /> |
| :----------------------------------------------------------------------------------------------------------------------------: | :--------------------------------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------: |
|                                                             HTML5                                                              |                                                             CSS3                                                             |                                                           javascript                                                            |

| <img src="https://profilinator.rishav.dev/skills-assets/react-original-wordmark.svg" alt="React.js" width="50px" height="50px" /> | <img src="https://stomp.github.io/images/project-logo.png" alt="stomp" height="50px" /> | <img src="https://raw.githubusercontent.com/gilbarbara/logos/master/logos/typescript-icon.svg" alt="typescript" width="50px" height="50px" /> |
| :-------------------------------------------------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------: |
|                                                               React                                                               |                                          Stomp                                          |                                                                  TypeScript                                                                   |

### **Back-end**

| <img src="https://profilinator.rishav.dev/skills-assets/java-original-wordmark.svg" alt="Java" width="50px" height="50px" /> | <img src="https://www.seekpng.com/png/full/8-80775_spring-logo-png-transparent-spring-java.png" alt="Spring-Boot" width="50px" height="50px" /> | <img src="https://spring.io/images/projects/spring-data-79cc203ed8c54191215a60f9e5dc638f.svg" alt="JPA" width="50px" height="50px" /> | <img src="https://spring.io/images/projects/spring-security-b712a4cdb778e72eb28b8c55ec39dbd1.svg" alt="Spring-Security" width="50px" height="50px" /> | <img src="https://jwt.io/img/pic_logo.svg" alt="jwt" width="50px" height="50px" /> |
| :--------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------------------------------: | :--------------------------------------------------------------------------------: |
|                                                             Java                                                             |                                                                   Spring-Boot                                                                   |                                                              Spring-JPA                                                               |                                                                    Spring-Security                                                                    |                                        JWT                                         |

### DB

| <img src="https://profilinator.rishav.dev/skills-assets/mysql-original-wordmark.svg" alt="MySQL" width="50px" height="50px" /> | <img src="https://raw.githubusercontent.com/devicons/devicon/1119b9f84c0290e0f0b38982099a2bd027a48bf1/icons/mongodb/mongodb-original-wordmark.svg" alt="MongoDB" width="50px" height="50px" /> |
| :----------------------------------------------------------------------------------------------------------------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|                                                             MySQL                                                              |                                                                                            Mongodb                                                                                             |

### **DevOps**

| <img src="https://profilinator.rishav.dev/skills-assets/nginx-original.svg" alt="NGiNX" width="50px" height="50px" /> | <img src="https://pbs.twimg.com/profile_images/1351702967561252865/aXfcETIt_400x400.jpg" alt="aws" width="50px" height="50px" /> | <img src="https://profilinator.rishav.dev/skills-assets/docker-original-wordmark.svg" alt="docker" width="50px" height="50px" /> | <img src="https://www.jenkins.io/images/logos/jenkins/jenkins.svg" alt="jenkins" width="50px" height="50px" /> | <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Kubernetes_logo_without_workmark.svg/926px-Kubernetes_logo_without_workmark.svg.png" alt="kubernetes" width="50px" height="50px" /> |
| :-------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|                                                         NGiNX                                                         |                                                               aws                                                                |                                                              docker                                                              |                                                    Jenkins                                                     |                                                                                               Kubernetes                                                                                                |

### ê¸°íš ë° ìš´ì˜

| <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Git-logo.svg/768px-Git-logo.svg.png?20160811101906" alt="Git" width="50px" height="50px" /> | <img src="https://wac-cdn-2.atlassian.com/image/upload/f_auto,q_auto/dam/jcr:b544631f-b225-441b-9e05-57b7fd0d495b/Jira%20Software@2x-icon-blue.png" alt="jira" width="50px" height="50px" /> | <img src="https://cdn2.downdetector.com/static/uploads/logo/figma2.png" alt="figma" width="50px" height="50px" /> | <img src="https://blog.kakaocdn.net/dn/2CufY/btq8RTsnYaT/3EQm1A8iL54UcCzFkemVJ1/img.png" alt="notion" width="50px" height="50px" /> | <img src="https://play-lh.googleusercontent.com/FERhw8K6nxOmNNthc4zLb6FnkO5_iDs-W4w3Uc_GiHosUYJlkeXHp-Qom5kbq4u__Ns" alt="mattermost" width="50px" height="50px" /> | <img src="https://play-lh.googleusercontent.com/0oO5sAneb9lJP6l8c6DH4aj6f85qNpplQVHmPmbbBxAukDnlO7DarDW0b-kEIHa8SQ=w512" alt="discord" width="50px" height="50px" /> |
| :-------------------------------------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|                                                                               Git                                                                               |                                                                                             JIRA                                                                                             |                                                       Figma                                                       |                                                               Notion                                                                |                                                                             Mattermost                                                                              |                                                                               Discord                                                                                |

### App

| <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Kotlin_Icon.svg/1200px-Kotlin_Icon.svg.png" alt="kotlin" width="50px" height="50px" /> | <img src="https://blog.kakaocdn.net/dn/bU8z6O/btqKXLx6c0Y/szaVg2oqCAUxMYex0n8zs1/img.png" alt="android_studio" width="50px" height="50px" /> | <img src="https://images.velog.io/images/gooreum_90/post/c53e169b-71ea-4bf5-84ce-9523949b2dfd/swiftlogo.png" alt="swift" width="50px" height="50px" /> | <img src="https://is5-ssl.mzstatic.com/image/thumb/Purple122/v4/9d/25/cf/9d25cfe3-2476-20ae-ed0f-8d67a188bad7/Xcode-85-220-0-4-2x.png/1200x630bb.png" alt="xcode" width="50px" height="50px" /> |
| :--------------------------------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|                                                                           Kotlin                                                                           |                                                                Android Studio                                                                |                                                                         Swift                                                                          |                                                                                              Xcode                                                                                              |

<br>

## ğŸ’ Team & Stack

<table>
<tr>
  <td valign="top" width="50%">
    <a href="https://github.com/eora21">
      <img src="README.assets/juho.png" align="left" style="width: 98%" />
    </a>
  </td>
  <td valign="top" width="50%">
    <a href="https://github.com/glowforever42">
      <img src="README.assets/hyi.png" align="left" style="width: 98%" />
    </a>
  </td>
</tr>
<tr>
  <td valign="top" width="50%">
    <a href="https://github.com/82surf">
      <img src="README.assets/hyunsu.png" align="left" style="width: 98%" />
    </a>
  </td>
  <td valign="top" width="50%">
    <a href="https://github.com/Gkuer">
      <img src="README.assets/gkuer.PNG" align="left" style="width: 98%" />
    </a>
  </td>
  </tr>
  <tr>
    <td valign="top" width="50%">
    <a href="https://github.com/EuneeChung">
      <img src="README.assets/eune.png" align="left" style="width: 98%" />
    </a>
  </td>
  <td valign="top" width="50%">
    <a href="https://github.com/gkstmdgns422">
      <img src="README.assets/seunghoon.png" align="left" style="width: 98%" />
    </a>
  </td>
</tr>
</table>

|       Content       |            Main             |                     Detail                     |
| :-----------------: | :-------------------------: | :--------------------------------------------: |
|   **kubernetes**    |         Kubernetes          |               Kubernetes 1.14.0                |
| **íŒŒì´í”„ë¼ì¸ êµ¬ì¶•** |           Jenkins           |                Jenkins Pipeline                |
|      **CI/CD**      | Docker, Jenkins, Kubernetes | Docker, Jenkins, Dockerhub, Kubernetes Rollout |
|  **Ingress Nginx**  |  Kubernetes Ingress-nginx   | Nginx, Let's encrypt, Kubernetes Ingress-nginx |
|      **ë°°í¬**       |             AWS             |          EC2(Ubuntu Server 20.04 LTS)          |

<br>

# âš™ï¸ ì¿ ë²„ë„¤í‹°ìŠ¤, ë„ì»¤, ì  í‚¨ìŠ¤ë¥¼ í™œìš©í•œ ë°°í¬ì™€ CI/CDì— ëŒ€í•˜ì—¬

### `ê°œìš”`

> ë†’ì€ íŠ¸ë˜í”½ê³¼ ì†Œì¼“ í†µì‹ ìœ¼ë¡œ ì¸í•œ ë¶€í•˜ë¥¼ ì˜ˆìƒí–ˆë‹¤. í•´ë‹¹ íŠ¸ë˜í”½ê³¼ ë¶€í•˜ë¥¼ Devopsê°€ ë‚˜ í˜¼ìì¸ ìš°ë¦¬ íŒ€ì´ ê°ë‹¹í•˜ê¸° ìœ„í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ë„ì…í–ˆë‹¤.

> ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ê³„ë¶€í„° CI/CD ì ìš©ê¹Œì§€, ì²˜ìŒì´ë¼ ì–´ë ¤ì› ê³ , ìë™í™”ê¹Œì§€ ì™„ì„±í–ˆì„ ë•ŒëŠ” ê·¸ë§Œí¼ ë³´ëŒì„ ëŠê¼ˆë‹¤.



#### ì¿ ë²„ë„¤í‹°ìŠ¤ ë„ì… ëª©ì 

*  ë¬´ì¤‘ë‹¨ ë°°í¬

*  ë¶€í•˜ë¶„ì‚°

*  ì˜¤í† íë§

*  ì»¨í…Œì´ë„ˆì˜ ê´€ë¦¬



#### í´ëŸ¬ìŠ¤í„° ì„¤ê³„

![Lovepush_Architecture](README.assets/Lovepush_Architecture.jpg)

* EC2 ì„œë²„ 4ê°œë¥¼ ê°€ìš©ìì›ìœ¼ë¡œ, ë§ˆìŠ¤í„° ë…¸ë“œ 1ê°œì™€ ì›Œì»¤ ë…¸ë“œ 3ê°œë¡œ êµ¬ì„±í•œë‹¤.

* Mysql, Mongodbë¡œ DB ì´ì›í™”ë¥¼ ì ìš©í•œë‹¤. (ì±„íŒ…ì˜ Readì†ë„ ê³ ë ¤)

* í•´ë‹¹ DBëŠ” PVC-PV ë§ˆìš´íŠ¸í•˜ì—¬ ì˜êµ¬ì ìœ¼ë¡œ ë³´ê´€í•œë‹¤.

* Desired State : ë°±ì—”ë“œëŠ” íŒŸ 10ê°œ / í”„ë¡ íŠ¸ì—”ë“œëŠ”  íŒŸ 7ê°œë¡œ ì„¤ì •í•˜ì˜€ë‹¤.

* EC2ì„œë²„ 4ê°œê°€ ê°€ìš©ìì›ìœ¼ë¡œ, ë§ˆìŠ¤í„° ë…¸ë“œ 1ê°œì™€ ì›Œì»¤ ë…¸ë“œ 3ê°œë¡œ êµ¬ì„±í•œë‹¤.

* Mysql, Mongodbë¡œ DB ì´ì›í™”ë¥¼ ì ìš©í•œë‹¤. (ì±„íŒ…ì˜ Readì†ë„ ê³ ë ¤)

* í•´ë‹¹ DBëŠ” PVC-PV ë§ˆìš´íŠ¸í•˜ì—¬ ì˜êµ¬ì ìœ¼ë¡œ ë³´ê´€í•œë‹¤.

* Desired State : ë°±ì—”ë“œëŠ” íŒŸ 10ê°œ / í”„ë¡ íŠ¸ì—”ë“œëŠ” íŒŸ 7ê°œë¡œ ì„¤ì •í•˜ì˜€ë‹¤.

* Ingress-nginxë¥¼ ì ìš©í•˜ì˜€ê³ , Let's Encryptë¥¼ í†µí•´ HTTPSë¥¼ ì ìš©í•˜ì˜€ë‹¤.

* Jenkins Pipelineì„ êµ¬ì¶•í•˜ì—¬, ì¼ë ¨ì˜ ê³¼ì •ì„ ìë™í™”í•œë‹¤.

  - Gitì˜ ë³€í™”ë¥¼ ê°ì§€í•˜ì—¬ Codeë¥¼ ë°›ì•„ì˜¤ê³ ,

  - í•´ë‹¹ ì½”ë“œë¡œ Docker Imageë¥¼ ìƒì„±í•œë‹¤.

  - ìƒì„±ëœ Docker Imageë¥¼ Dockerhubì— Pushí•œë‹¤.

  - Kubeì™€ ì—°ë™í•˜ì—¬ í•´ë‹¹ Deploymentë¥¼ Rolloutí•œë‹¤.

* Mattermostì™€ ì—°ë™í•˜ì—¬ ë¹Œë“œ í˜„í™©ê³¼ ë¡œê·¸ë¥¼ ê³µìœ í•œë‹¤.

<br>

## ğŸª êµ¬í˜„

## 1. Master node & Worker node ì„¤ì¹˜ ë° ì—°ê²°

- [ê°œë°œ ë ˆí¼ëŸ°ìŠ¤](https://www.notion.so/f1250dbff0914f64a63ba3009d1e93ba)

## 2. Mysql

### ì»¨í…Œì´ë„ˆ ì´ë™

- Gkuerâ€™s Mac â‡’ Ubuntu Server (Docker Image Commit)

  - ë¡œì»¬ì—ì„œ ëŒê³  ìˆë˜ Docker Process

  ```bash
  ~ Â» docker ps -a                                                                                                
  CONTAINER ID   IMAGE               COMMAND                  CREATED       STATUS        PORTS                               NAMES
  9cf192c49625   jenkins/joalarm     "java -jar /app.jar"     4 hours ago   Up 4 hours    0.0.0.0:8888->8888/tcp              jenkins-joalarm
  069395ce7cc1   mongo               "docker-entrypoint.sâ€¦"   5 days ago    Up 13 hours   0.0.0.0:27017->27017/tcp            mongodb
  b51d9e9b3678   jenkins/myjenkins   "/sbin/tini -- /usr/â€¦"   6 days ago    Up 13 hours   0.0.0.0:8080->8080/tcp, 50000/tcp   jenkins
  1ba9da064b77   mysql               "docker-entrypoint.sâ€¦"   6 days ago    Up 13 hours   0.0.0.0:3306->3306/tcp, 33060/tcp   cupid
  ```

  - Mysql Commit

  ```bash
  ~ Â» docker commit 1ba9da064b77 joalarm-mysql                                                                 
  sha256:7f4888b6400c74a46db1a9d9518033ffc6315fb3933a8e905c99d011a18815ae
  ```

  - Tag ë‹¬ê¸°

  ```bash
  ~ Â» docker tag joalarm-mysql $docker_id_user/joalarm-mysql
  ```

  - Dockerhub Push

  ```bash
  ~ Â» docker push $docker_id_user/joalarm-mysql                                                               
  Using default tag: latest
  The push refers to repository [docker.io/gkuer/joalarm-mysql]
  6b4a66619f38: Pushed
  20048e9ea24b: Mounted from library/mysql
  f654c732eb30: Mounted from library/mysql
  d89c67210fbb: Mounted from library/mysql
  999500c33f79: Mounted from library/mysql
  e19e05fc6c0c: Mounted from library/mysql
  f1ce24a3a906: Mounted from library/mysql
  bcdcddd1968e: Mounted from library/mysql
  a6139270daa5: Mounted from library/mysql
  f8589c04a7c4: Mounted from library/mysql
  726b89cb4adb: Mounted from library/mysql
  83798bb64452: Mounted from library/mysql
  c1065d45b872: Mounted from library/mysql
  latest: digest: sha256:f0172f2a9f054230231b349208f6de009efb0ad9e68983c3d90a138b46a00b41 size: 3035
  ```

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-25 á„‹á…©á„’á…® 10.21.38.png](README.assets/dockerhub_mysql.png)

### PV

- PV/PVC ì ìš© ì´ìœ 

  - emptydirë¡œ êµ¬ì„±í•  ê²½ìš° podì´ ì‚¬ë¼ì§ˆ ë•Œ, í•¨ê»˜ ì‚¬ë¼ì ¸ ë¬¸ì œê°€ ìˆìŒ
  - hostpathë¡œ êµ¬ì„±í•  ê²½ìš° podì˜ node ìœ„ì¹˜ê°€ ë³€í•˜ë©´, ë¬¸ì œê°€ ë˜ê¸° ë•Œë¬¸ì— ì‹¤ë¬´ì—ì„œ ì“°ê¸°ì—ëŠ” ì œì•½ì‚¬í•­ì´ í¼
  - ë”°ë¼ì„œ, podê³¼ nodeì— ìƒê´€ì—†ì´ ì¤‘ìš”ë„ ìˆëŠ” ìì›ì¸ DBë¥¼ ì˜êµ¬ ì €ì¥í•˜ê¸° ìœ„í•´ PV/PVC ì‚¬ìš©

- PV ìƒì„±í•  ë…¸ë“œì— ì‘ì—…í´ë” ì„¤ì •

  ```bash
  $ sudo mkdir -p /workspace/kubernetes/mysql
  $ sudo chown -R truelifer:truelifer /workspace/kubernetes
  $ cd /workspace/kubernetes/mysql
  ```

- StorageClass ìƒì„±

  ```bash
  kind: StorageClass
  apiVersion: storage.k8s.io/v1
  metadata:
    name: local-storage-mysql
  provisioner: kubernetes.io/no-provisioner
  volumeBindingMode: WaitForFirstConsumer
  ```

- PV ìƒì„±í•  ë…¸ë“œì— ì €ì¥ë  í´ë” ë° ê¶Œí•œ ë¶€ì—¬

  ```bash
  $ sudo mkdir -p /workspace/data/kubernetes/pv/mysql
  $ sudo chmod 777 /workspace/data/kubernetes/pv/mysql
  ```

- PV ìƒì„±

  ```bash
  apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: pv-mysql
  spec:
    capacity:
      storage: 10Gi
    accessModes:
    - ReadWriteOnce
    persistentVolumeReclaimPolicy: Retain
    storageClassName: local-storage-mysql
    local:
      path: /workspace/data/kubernetes/pv/mysql
    nodeAffinity:
      required:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/hostname
            operator: In
            values:
            - ip-172-26-7-13
  ```

### PVC

- PVC ìƒì„±

  ```bash
  kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: pvc-mysql
  spec:
    accessModes:
    - ReadWriteOnce
    storageClassName: local-storage-mysql
    resources:
      requests:
        storage: 10Gi
  ```

### Deployment

- Deployment ìƒì„±

  ```bash
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: mysql
  spec:
    selector:
      matchLabels:
        app: mysql
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          app: mysql
      spec:
        containers:
        - image: gkuer/joalarm-mysql
          name: mysql
          ports:
          - containerPort: 3306
            name: mysql
          volumeMounts:
          - name: volume-mysql
            mountPath: /var/lib/mysql
        volumes:
        - name: volume-mysql
          persistentVolumeClaim:
            claimName: pvc-mysql
  ```

### Service

- Service ìƒì„±

  ```bash
  apiVersion: v1
  kind: Service
  metadata:
    name: service-mysql
  spec:
    type: NodePort
    selector:
      app: mysql
    ports:
      - protocol: TCP
        port: 3306
        nodePort: 30000
        targetPort: 3306
  ```

## 3. Mongodb

### ì»¨í…Œì´ë„ˆ ì´ë™

- Gkuerâ€™s Mac â‡’ Ubuntu Server (Docker Image Commit)

  - ë¡œì»¬ì—ì„œ ëŒê³  ìˆë˜ Docker Process

  ```bash
  ~ Â» docker ps -a                                                                                             
  CONTAINER ID   IMAGE               COMMAND                  CREATED       STATUS        PORTS                               NAMES
  9cf192c49625   jenkins/joalarm     "java -jar /app.jar"     4 hours ago   Up 4 hours    0.0.0.0:8888->8888/tcp              jenkins-joalarm
  069395ce7cc1   mongo               "docker-entrypoint.sâ€¦"   5 days ago    Up 13 hours   0.0.0.0:27017->27017/tcp            mongodb
  b51d9e9b3678   jenkins/myjenkins   "/sbin/tini -- /usr/â€¦"   6 days ago    Up 13 hours   0.0.0.0:8080->8080/tcp, 50000/tcp   jenkins
  1ba9da064b77   mysql               "docker-entrypoint.sâ€¦"   6 days ago    Up 13 hours   0.0.0.0:3306->3306/tcp, 33060/tcp   cupid
  ```

  - Mongodb Commit

  ```bash
  ~ Â» docker commit 069395ce7cc1 joalarm-mongo
  sha256:7cd16756e8977048e785ce1501ee828f9297588437aa62d5763600c1931445ee
  ```

  - Tag ë‹¬ê¸°

  ```bash
  ~ Â» docker tag joalarm-mongo $docker_id_user/joalarm-mongo
  ```

  - Dockerhub Push

  ```bash
  ~ Â» docker push $docker_id_user/joalarm-mongo                                                                                      
  Using default tag: latest
  The push refers to repository [docker.io/gkuer/joalarm-mongo]
  80499f2d5cc7: Pushed
  df4fb866be24: Pushed
  2589885a8bde: Pushed
  ae384ea51b6b: Pushed
  5edfa274a10d: Pushed
  2b3691b33f48: Pushed
  36be1891c787: Pushed
  af26174c4942: Pushed
  5eb80b566e76: Pushed
  579eea2a4698: Pushed
  c5ec52c98b31: Pushed
  latest: digest: sha256:af931c846a19e30ba3b43f9d39a4eb6557e860a77f79f97a4c3dd3162604bdbf size: 2616
  ```

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-25 á„‹á…©á„’á…® 10.16.24.png](README.assets/dockerhub_mongo.png)

### PV

- PV ìƒì„±í•  ë…¸ë“œì— ì‘ì—…í´ë” ì„¤ì •

  ```bash
  $ sudo mkdir -p /workspace/kubernetes/mongo
  $ sudo chown -R truelifer:truelifer /workspace/kubernetes
  $ cd /workspace/kubernetes/mongo
  ```

- StorageClass ìƒì„±

  ```yaml
  kind: StorageClass
  apiVersion: storage.k8s.io/v1
  metadata:
    name: local-storage-mongo
  provisioner: kubernetes.io/no-provisioner
  volumeBindingMode: WaitForFirstConsumer
  ```

- PV ìƒì„±í•  ë…¸ë“œì— ì €ì¥ë  í´ë” ë° ê¶Œí•œ ë¶€ì—¬

  ```bash
  $ sudo mkdir -p /workspace/data/kubernetes/pv/mongo
  $ sudo chmod 777 /workspace/data/kubernetes/pv/mongo
  ```

- PV ìƒì„±

  ```yaml
  apiVersion: v1
  kind: PersistentVolume
  metadata:
    name: pv-mongo
  spec:
    capacity:
      storage: 10Gi
    accessModes:
    - ReadWriteOnce
    persistentVolumeReclaimPolicy: Retain
    storageClassName: local-storage-mongo
    local:
      path: /workspace/data/kubernetes/pv/mongo
    nodeAffinity:
      required:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/hostname
            operator: In
            values:
            - ip-172-26-7-13
  ```

### PVC

- PVC ìƒì„±

  ```yaml
  kind: PersistentVolumeClaim
  apiVersion: v1
  metadata:
    name: pvc-mongo
  spec:
    accessModes:
    - ReadWriteOnce
    storageClassName: local-storage-mongo
    resources:
      requests:
        storage: 10Gi
  ```

### Deployment

- Deployment ìƒì„±

  ```yaml
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: mongo
  spec:
    selector:
      matchLabels:
        app: mongo
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          app: mongo
      spec:
        containers:
        - image: gkuer/joalarm-mongo
          name: mysql
          ports:
          - containerPort: 27017
            name: mysql
          volumeMounts:
          - name: volume-mongo
            mountPath: /var/lib/mongo
        volumes:
        - name: volume-mongo
          persistentVolumeClaim:
            claimName: pvc-mongo
  ```

### Service

- Service ìƒì„±

  ```yaml
  apiVersion: v1
  kind: Service
  metadata:
    name: service-mongo
  spec:
    type: NodePort
    selector:
      app: mongo
    ports:
      - protocol: TCP
        port: 27017
        nodePort: 30001
        targetPort: 27017
  ```



## 4. Springboot

### Springboot ë°°í¬ ì…‹íŒ…

- application-dev.yml ì¶”ê°€

  ```yaml
  # ========== Spring Configuration ===========
  spring:
    profiles:
      active:
        on-profile: dev
  	...
  ```

- Docker build ì˜µì…˜ ë³€ê²½

  - â€”build-arg ENVIRONMENT devë¡œ ë¹Œë“œ

  ```bash
  docker build --build-arg ENVIRONMENT=dev -t joalarm .
  ```

- application-dev.yml ì¤‘ìš” ì •ë³´ ë³€ê²½

  ```yaml
  datasource:
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://${MYSQL_CLUSTER_IP}:3306/joalarm?serverTimezone=Asia/Seoul
      username: ${USERNAME}
      password: ${PASSWORD}
  
    data:
      mongodb:
        uri: mongodb://${MONGO_CLUSTER_IP}:27017/joalarm
  ```

### ì»¨í”¼ê·¸ & ì‹œí¬ë¦¿

- ì»¨í”¼ê·¸ ìƒì„±

  ```yaml
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: joalarm-springboot-config
  data:
    mongo-cluster-ip: 10.110.196.42
    mysql-cluster-ip: 10.99.58.77
  ```

  ```yaml
  apiVersion: v1
  kind: ConfigMap
  metadata:
    name: joalarm-s3-config
  data:
    s3-bucket-name: cupid-joalarm
  ```

- ì‹œí¬ë¦¿ ìƒì„±

  ```yaml
  apiVersion: v1
  kind: Secret
  metadata:
    name: joalarm-springboot-secret
  data:
    username: Y3VwaWQ=
    password: MTAwNQ==
  ```

  ```yaml
  kind: Secret
  apiVersion: v1
  metadata:
    name: joalarm-s3-secret
  data:
    aws-access-key: QUtJQVhCNUI0Q09VWDNISDZVRUwK
    aws-secret-key: WS96NTdNRzZQTWpwSENJdGR6TDg5RklaR1c3a2tLd2s1bGs5R1JHYwo=
  ```

  ```yaml
  kind: Secret
  apiVersion: v1
  metadata:
    name: joalarm-jwt-secret
  data:
    jwt-secret-key: >-
      YzJsc2RtVnlibWx1WlMxMFpXTm9MWE53Y21sdVp5MWliMjkwTFdwM2RDMTBkWFJ2Y21saGJDMXpaV055WlhRdGMybHNkbVZ5Ym1sdVpTMTBaV05vTFhOd2NtbHVaeTFpYjI5MExXcDNkQzEwZFhSdmNtbGhiQzF6WldOeVpYUUsK
  
  ```

### ë„ì»¤ ì´ë¯¸ì§€ PUSH

- ë¡œì»¬ ë„ì»¤ í”„ë¡œì„¸ìŠ¤

  ```bash
  ~/Desktop/S06P31B206/backend/joalarm (develop) Â» docker ps -a                                                                      1 â†µ gkuer@Gkuerui-MacBookPro
  CONTAINER ID   IMAGE               COMMAND                  CREATED          STATUS          PORTS                               NAMES
  443a166088c2   jenkins/joalarm     "java -jar /app.jar"     13 seconds ago   Up 12 seconds   0.0.0.0:8888->8888/tcp              jenkins-joalarm
  069395ce7cc1   mongo               "docker-entrypoint.sâ€¦"   5 days ago       Up 29 hours     0.0.0.0:27017->27017/tcp            mongodb
  b51d9e9b3678   jenkins/myjenkins   "/sbin/tini -- /usr/â€¦"   6 days ago       Up 29 hours     0.0.0.0:8080->8080/tcp, 50000/tcp   jenkins
  1ba9da064b77   mysql               "docker-entrypoint.sâ€¦"   7 days ago       Up 29 hours     0.0.0.0:3306->3306/tcp, 33060/tcp   cupid
  ```

- Springboot PS ì»¤ë°‹

  ```bash
  ~/Desktop/S06P31B206/backend/joalarm (develop) Â» docker commit 443a166088c2 joalarm-springboot                                         gkuer@Gkuerui-MacBookPro
  sha256:08474e36afb5a23efc0be26dad2b8afe0394a64f18da07fa3f5ac7855d5f223e
  ```

- Springboot Tagging

  ```bash
  ~/Desktop/S06P31B206/backend/joalarm (develop) Â» docker tag joalarm-springboot gkuer/joalarm-springboot
  ```

- Dockerhub Push

  ```bash
  ~/Desktop/S06P31B206/backend/joalarm (develop) Â» docker push gkuer/joalarm-springboot                                                  gkuer@Gkuerui-MacBookPro
  Using default tag: latest
  The push refers to repository [docker.io/gkuer/joalarm-springboot]
  b9423c3e2cd4: Pushed
  ba321ed46ce9: Pushed
  0a41459588e0: Mounted from library/openjdk
  30e908a38a18: Pushed
  cac2fff6ae3d: Mounted from library/openjdk
  08fa02ce37eb: Mounted from library/openjdk
  a037458de4e0: Mounted from library/openjdk
  bafdbe68e4ae: Mounted from library/openjdk
  a13c519c6361: Mounted from library/openjdk
  latest: digest: sha256:f7d6930050765fc61b20f19d401bb55a1f5024a6738650d25a46feb99ff53204 size: 2215
  ```

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-26 á„‹á…©á„’á…® 2.33.34.png](README.assets/dockerhub_springboot.png)

### Deployment

- Deployment ìƒì„±

  ```yaml
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: springboot
    labels:
      app: springboot
  spec:
    selector:
      matchLabels:
        app: springboot
    replicas: 3
    template:
      metadata:
        labels:
          app: springboot
      spec:
        containers:
        - image: gkuer/joalarm-springboot
          name: springboot
          ports:
          - containerPort: 8888
          env:
          - name: MYSQL_CLUSTER_IP
            valueFrom:
              configMapKeyRef:
                name: joalarm-springboot-config
                key: mysql-cluster-ip
          - name: MONGO_CLUSTER_IP
            valueFrom:
              configMapKeyRef:
                name: joalarm-springboot-config
                key: mongo-cluster-ip
          - name: S3_BUCKET_NAME
            valueFrom:
              configMapKeyRef:
                name: joalarm-s3-config
                key: s3-bucket-name
          - name: USERNAME
            valueFrom:
              secretKeyRef:
                name: joalarm-springboot-secret
                key: username
          - name: PASSWORD
            valueFrom:
              secretKeyRef:
                name: joalarm-springboot-secret
                key: password
          - name: AWS_ACCESS_KEY
            valueFrom:
              secretKeyRef:
                name: joalarm-s3-secret
                key: aws-access-key
          - name: AWS_SECRET_KEY
            valueFrom:
              secretKeyRef:
                name: joalarm-s3-secret
                key: aws-secret-key
          - name: JWT_SECRET_KEY
            valueFrom:
              secretKeyRef:
                name: joalarm-jwt-secret
                key: jwt-secret-key
  ```

### Service

- Service ìƒì„±

  ```yaml
  apiVersion: v1
  kind: Service
  metadata:
  	name: service-springboot
  spec:
    selector:
      app: springboot
    ports:
  	  - port: 8888
  	    protocol: TCP
  	    targetPort: 8888
    type: LoadBalancer
  ```

- ì™¸ë¶€ ì ‘ì†

  - ë„ë©”ì¸ : [http://3.35.170.113/](http://3.35.170.113/)
  - service-springboot í¬íŠ¸ : 31738
  - [http://3.35.170.113](http://3.35.170.113/):31738 ë¡œ ì ‘ì† ì‹œ, 3ê°œì˜ íŒŸìœ¼ë¡œ ë¡œë“œë°¸ëŸ°ì‹±ë˜ë©° ì—°ê²° ê°€ëŠ¥

## 5. Jenkins(DooD)

### Docker out of Docker ì„¤ì • ì´ë¯¸ì§€

- docker_install.sh ìƒì„±

  ```bash
  #!/bin/sh
  apt-get update && \
  apt-get -y install apt-transport-https \
       ca-certificates \
       curl \
       gnupg2 \
       zip \
       unzip \
       software-properties-common && \
  curl -fsSL https://download.docker.com/linux/$(. /etc/os-release; echo "$ID")/gpg > /tmp/dkey; apt-key add /tmp/dkey && \
  add-apt-repository \
     "deb [arch=amd64] https://download.docker.com/linux/$(. /etc/os-release; echo "$ID") \
     $(lsb_release -cs) \
     stable" && \
  apt-get update && \
  apt-get -y install docker-ce
  ```

- Jenkins Dockerfile ìƒì„±

  ```docker
  #ê³µì‹ ì  í‚¨ìŠ¤ ì´ë¯¸ì§€ë¥¼ ë² ì´ìŠ¤ë¡œ í•œë‹¤.
  FROM jenkins/jenkins:lts
  
  #root ê³„ì •ìœ¼ë¡œ ë³€ê²½(for docker install)
  USER root
  
  #DIND(docker in docker)ë¥¼ ìœ„í•´ docker ì•ˆì—ì„œ dockerë¥¼ ì„¤ì¹˜
  COPY docker_install.sh /docker_install.sh
  RUN chmod +x /docker_install.sh
  RUN /docker_install.sh
  
  RUN usermod -aG docker jenkins
  USER jenkins
  ```

- ë¹Œë“œ í›„ ë„ì»¤í—ˆë¸Œë¡œ í‘¸ì‰¬

  ```bash
  docker build -t gkuer/jenkins-dind:latest .
  docker push gkeur/jenkins-dind
  ```

- ë³¼ë¥¨ìœ¼ë¡œ ì‚¬ìš©í•  ë””ë ‰í† ë¦¬ ì„¤ì •

  - ìƒì„±

  ```bash
  mkdir /home/deploy/jenkins_v
  ```

  - ê¶Œí•œë¶€ì—¬

  ```bash
  sudo chown 1000 .
  ```

- ì›Œì»¤ë…¸ë“œ1ì—ì„œ Run

  ```bash
  docker run -d --name jenkins -p 8080:8080 -p 50000:50000 \
          -v /home/deploy/jenkins_v:/var/jenkins_home \
          -v /var/run/docker.sock:/var/run/docker.sock \
          gkuer/jenkins-dind:latest
  ```

- [http://3.35.170.113:30002](http://3.35.170.113:30002/login?from=%2F) ì ‘ì† ë° ì´ˆê¸° ì…‹íŒ…

  - ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë° ì ‘ì†

  ```bash
  jenkins@jenkins-8455f486bf-rdtt5:/$ cat /var/jenkins_home/secrets/initialAdminPassword
  0c0bd3e457e84cf7ad384c5fd58eda4c
  ```

  - Suggested Plugins ì„¤ì¹˜

- Gitlab ì—°ê²° ë° ë³€í™” ê°ì§€

  - [Gitlab Access í† í° ë°œê¸‰](https://www.notion.so/jenkins-gitlab-Web-Hook-d5c96780501b41738f3c89568644f0c6) ì°¸ì¡°

- dockerhub-jenkins Credentials ì„¤ì •

  - Dockerhub accesstoken ë°œê¸‰

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-27 á„‹á…©á„’á…® 4.58.03.png](README.assets/dockerhub_token.png)Credential ë“±ë¡

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-27 á„‹á…©á„’á…® 4.59.03.png](README.assets/jenkins_token.png)

- íŒŒì´í”„ë¼ì¸ êµ¬ì¶• (Build Image & to Dcokerhub)

  - Jenkinsfile -  Pipeline ë¼ì¸ êµ¬ì„±

  ```bash
  pipeline{
  
  	agent any
  
  	environment {
  		DOCKERHUB_CREDENTIALS=credentials('dockerhub')
  	}
  
  	stages {
  
  		stage('Build') {
  
  			steps {
  			    dir("./backend/joalarm") {
  			        sh 'chmod +x ./gradlew'
                      sh './gradlew clean build'
                      sh 'docker build --build-arg ENVIRONMENT=dev -t gkuer/joalarm-springboot .'
  			    }
  			}
  		}
  
  		stage('Login') {
  
  			steps {
  				sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
  			}
  		}
  
  		stage('Push') {
  
  			steps {
  				sh 'docker push gkuer/joalarm-springboot'
  			}
  		}
  	}
  
  	post {
  		always {
  			sh 'docker logout'
  		}
  	}
  }
  ```

- Dockerfile ë³€ê²½

  - app.jar ë’¤ì— / ì¶”ê°€

  ```docker
  FROM openjdk:11
  EXPOSE 8888
  ARG JAR_FILE=build/libs/*.jar
  COPY ${JAR_FILE} app.jar/
  ENTRYPOINT ["java", "-jar", "/app.jar"]
  ```

- Pipeline script from SCM êµ¬ì„±

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-27 á„‹á…©á„’á…® 7.00.55.png](README.assets/jenkins_scm.png)

- K8S Deployment

  - imagePullPolicy: Always ì„¤ì •

  ```yaml
  spec:
        containers:
          - name: springboot
            image: gkuer/joalarm-springboot
            ports:
              - containerPort: 8888
                protocol: TCP
            imagePullPolicy: Always
  ```

- íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-27 á„‹á…©á„’á…® 7.14.33.png](README.assets/jenkins_pipeline.png)



## 6. React

### Docker Image

- nginx.conf ìƒì„±

  - /Users/gkuer/Desktop/S06P31B206/frontend/nginx.conf

  ```bash
  server {
      listen 80;
      location / {
          root    /app/build;
          index   index.html;
          try_files $uri $uri/ /index.html;
      }
  }
  ```

- React build

  ```bash
  ~/Desktop/S06P31B206/frontend (develop*) Â» npm i
  ~/Desktop/S06P31B206/frontend (develop*) Â» npm run build
  ```

- Dockerfile ìƒì„±

  ```bash
  # nginx ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë’¤ì— tagê°€ ì—†ìœ¼ë©´ latest ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  FROM nginx
  
  # root ì— app í´ë”ë¥¼ ìƒì„±
  RUN mkdir /app
  
  # work dir ê³ ì •
  WORKDIR /app
  
  # work dir ì— build í´ë” ìƒì„± /app/build
  RUN mkdir ./build
  
  # host pcì˜ í˜„ì¬ê²½ë¡œì˜ build í´ë”ë¥¼ workdir ì˜ build í´ë”ë¡œ ë³µì‚¬
  ADD ./build ./build
  
  # nginx ì˜ default.conf ë¥¼ ì‚­ì œ
  RUN rm /etc/nginx/conf.d/default.conf
  
  # host pc ì˜ nginx.conf ë¥¼ ì•„ë˜ ê²½ë¡œì— ë³µì‚¬
  COPY ./nginx.conf /etc/nginx/conf.d
  
  # 80 í¬íŠ¸ ì˜¤í”ˆ
  EXPOSE 80
  
  # container ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰í•  command. nginx ì‹œì‘í•¨
  CMD ["nginx", "-g", "daemon off;"]
  ```

- ì´ë¯¸ì§€ ë¹Œë“œ

  ```bash
  ~/Desktop/S06P31B206/frontend (develop*) Â» docker build -t gkuer/joalarm-react:latest .                                                gkuer@Gkuerui-MacBookPro
  [+] Building 2.3s (11/11) FINISHED
   => [internal] load build definition from Dockerfile                                                                                                       0.0s
   => => transferring dockerfile: 37B                                                                                                                        0.0s
   => [internal] load .dockerignore                                                                                                                          0.0s
   => => transferring context: 34B                                                                                                                           0.0s
   => [internal] load metadata for docker.io/library/node:16.14.2                                                                                            2.1s
   => [auth] library/node:pull token for registry-1.docker.io                                                                                                0.0s
   => [1/5] FROM docker.io/library/node:16.14.2@sha256:6e54786b2ad01667d46524e82806298714f50d2be72b39706770aed55faedbd7                                      0.0s
   => [internal] load build context                                                                                                                          0.0s
   => => transferring context: 4.65kB                                                                                                                        0.0s
   => CACHED [2/5] WORKDIR /app                                                                                                                              0.0s
   => CACHED [3/5] COPY package.json /app/package.json                                                                                                       0.0s
   => CACHED [4/5] RUN npm install                                                                                                                           0.0s
   => [5/5] COPY . ./                                                                                                                                        0.0s
   => exporting to image                                                                                                                                     0.1s
   => => exporting layers                                                                                                                                    0.0s
   => => writing image sha256:1372585e89e7c0c066edc3f25a4b696d2ad72fac64dad516d277bc49daedd163                                                               0.0s
   => => naming to docker.io/gkuer/joalarm-react:latest                                                                                                      0.0s
  
  Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them
  ```

- Dockerhub Push

  ```bash
  ~/Desktop/S06P31B206/frontend (develop*) Â» docker push gkuer/joalarm-react                                                             gkuer@Gkuerui-MacBookPro
  Using default tag: latest
  The push refers to repository [docker.io/gkuer/joalarm-react]
  9b4218f20645: Pushed
  4d2ccb6fe16f: Layer already exists
  fed48c58f14e: Layer already exists
  2f63f4c17307: Layer already exists
  3e4801a3cfe3: Layer already exists
  52101239f8c7: Layer already exists
  e0bd9c8e45b3: Layer already exists
  6fd97e423126: Layer already exists
  ca58f1c44290: Layer already exists
  957a6eed8d1f: Layer already exists
  85fe00380881: Layer already exists
  5d253e59e523: Layer already exists
  b9fd5db9c9a6: Layer already exists
  latest: digest: sha256:51bb4040cec3eb57fc8072b4a4df76ae2bc8bd88a9ca3c70c06516767826bd5e size: 3051
  ```

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-28 á„‹á…©á„’á…® 3.40.50.png](README.assets/dockerhub-react.png)

### ì¿ ë²„ë„¤í‹°ìŠ¤ Deployment - ReplicaSet - Service

- Deployment ìƒì„±

  ```bash
  kind: Deployment
  apiVersion: apps/v1
  metadata:
    name: react
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: react
    template:
      metadata:
        labels:
          app: react
      spec:
        containers:
          - name: react
            image: gkuer/joalarm-react
            imagePullPolicy: Always
            ports:
              - containerPort: 80
        restartPolicy: Always
  ```

- Service ìƒì„±

  ```bash
  kind: Service
  apiVersion: v1
  metadata:
    name: service-react
  spec:
    type: NodePort
    ports:
      - port: 80
        targetPort: 80
        protocol: TCP
        nodePort: 31000
    selector:
      app: react
  ```

### Jenkins Pipeline êµ¬ì¶•

- Pipeline Script

  ```bash
  pipeline{
  
  	agent any
  
  	environment {
  		DOCKERHUB_CREDENTIALS=credentials('dockerhub')
  	}
  
  	stages {
  
  		stage('Build') {
  
  			steps {
  			    dir("./frontend") {
  			        sh 'npm i'
                sh 'CI=false npm run build'
                sh 'docker build -t gkuer/joalarm-react:latest .'
  			    }
  			}
  		}
  
  		stage('Login') {
  
  			steps {
  				sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
  			}
  		}
  
  		stage('Push') {
  
  			steps {
  				sh 'docker push gkuer/joalarm-react'
  			}
  		}
  	}
  
  	post {
  		always {
  			sh 'docker logout'
  		}
  	}
  
  }
  ```

- íŒŒì´í”„ë¼ì¸ êµ¬ì¶• (Git â‡’ Jenkins ì´ë¯¸ì§€ ë¹Œë“œ â‡’ Dockerhub)

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-04-28 á„‹á…©á„’á…® 7.27.54.png](README.assets/pipeline.png)

## 7. Ingress-Nginx

- Ingress ì‚¬ìš© ì´ìœ 
  - Service Loadbalancing
    - Front(/~) / Back (/api~)ìœ¼ë¡œ ë¶„ê¸°
  - ì¹´ë‚˜ë¦¬ ì—…ë°ì´íŠ¸
    - ì‚¬ìš© ì•ˆí•¨
  - https
    - httpsë¡œë§Œ ë“¤ì–´ì˜¬ ìˆ˜ ìˆê²Œ

### Nginx Deployment

- Nginx ì„¤ì¹˜

  ```bash
  kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.0.0/deploy/static/provider/baremetal/deploy.yaml
  ```

- Ingress

  ```yaml
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: ingress-nginx
  spec:
    ingressClassName: nginx
    tls:
    - hosts:
      - www.someone-might-like-you.com
      secretName: someone
    rules:
    - host: www.someone-might-like-you.com
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: service-react
              port:
                number: 80
        - path: /api
          pathType: Prefix
          backend:
            service:
              name: service-springboot
              port:
                number: 8888
  ```

- ingress-nginx íŒŸ ìƒíƒœ í™•ì¸

  ```bash
  ubuntu@ip-172-26-10-112:/workspace/data/kubernetes/pv/mysql$ kubectl get pod -n ingress-nginx
  NAME                                        READY   STATUS      RESTARTS   AGE
  ingress-nginx-admission-create-nfp8d        0/1     Completed   0          11m
  ingress-nginx-admission-patch-2k77f         0/1     Completed   1          11m
  ingress-nginx-controller-75f58fbf6b-ms2l6   1/1     Running     0          11m
  ```

- ì„œë¹„ìŠ¤ ë…¸ë“œí¬íŠ¸ ìƒíƒœ í™•ì¸

  ```bash
  ubuntu@ip-172-26-10-112:/workspace/data/kubernetes/pv/mysql$ kubectl get svc -n ingress-nginx
  NAME                                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
  ingress-nginx-controller             NodePort    10.106.85.10     <none>        80:31551/TCP,443:31544/TCP   11m
  ingress-nginx-controller-admission   ClusterIP   10.100.172.224   <none>        443/TCP                      11m
  ```

### HTTPS-Kubernetes í´ëŸ¬ìŠ¤í„° ì ìš©

- certbot Docker ì‹¤í–‰

  ```yaml
  ubuntu@ip-172-26-10-112:~$ docker run -it --rm --name cert_tmp -p 80:80 -v /home/ubuntu/cert:/etc/letsencrypt certbot/certbot certonly \
  > --standalone -d www.someone-might-like-you.com -m gkuer95@gmail.com
  Unable to find image 'certbot/certbot:latest' locally
  latest: Pulling from certbot/certbot
  339de151aab4: Pull complete
  a860e27ad689: Pull complete
  910a9a405b4b: Pull complete
  bde2ad12a253: Pull complete
  c6c8e9f0153d: Pull complete
  d397e2192fef: Pull complete
  3fb10b303714: Pull complete
  aaed35ce1e39: Pull complete
  42fcc09e2708: Pull complete
  382c4f12dd55: Pull complete
  75303e53b8f0: Pull complete
  4159d49c5283: Pull complete
  3bb01cd6d90b: Pull complete
  Digest: sha256:cbe9b78876080e0e7b5bd715c0a3057eb11e9ba34922f68df8252a5e3e986d1a
  Status: Downloaded newer image for certbot/certbot:latest
  Saving debug log to /var/log/letsencrypt/letsencrypt.log
  ```

- sudoë¡œ root ê³„ì •ìœ¼ë¡œ ì „í™˜

  ```yaml
  sudo -i
  ```

- cp

  ```yaml
  cp /home/ubuntu/cert/live ~~/*.pem /home/ubuntu/
  ```

- ê¶Œí•œì£¼ê¸°

  ```yaml
  sudo chown ubuntu:ubuntu *.pem
  ```

- tls ë‹¤ìš´ë¡œë“œ

  ```bash
  ubuntu@ip-172-26-10-112:/workspace/ssl$ sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=www.someone-might-like-you.com/O=www.someone-might-like-you.com"
  Generating a RSA private key
  .....................................+++++
  .....................+++++
  writing new private key to 'tls.key'
  -----
  ```

- ê¶Œí•œ ë³€ê²½

  ```bash
  sudo -i
  ```

- ubuntuë¡œ ë³µì‚¬

  ```bash
  root@ip-172-26-10-112: copy *.pem /home/ubuntu
  ```

- tls ì‹œí¬ë¦¿ ì§€ì •

  ```bash
  kubectl create secret tls someone --key privkey.pem --cert cert.pem
  ```

  - â‡’ ìˆ˜ì •, ì•ˆë“œë¡œì´ë“œì—ì„œ cert.pemì„ ì¸ì‹í•˜ì§€ ëª»í•¨ â‡’ fullchain.pemìœ¼ë¡œ ìˆ˜ì •

    ```bash
    kubectl create secret tls someone2 --key privkey.pem --cert fullchain.pem
    ```

### Nodeport â†’ LoadBalancer - ì™¸ë¶€ Well-known í¬íŠ¸ë¡œ ë³€ê²½

- Ingress-nginx service íƒ€ì… ë³€ê²½

  ```yaml
  ...
  ,"type":"LoadBalancer"}}
  ...
  spec:
    type: LoadBalancer
  ...
  ```

- externalIps ì„¤ì • - ë‚´ë¶€ IP(Master node)

  ```yaml
  externalIPs:
      - 172.26.10.112
  ```

- ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ í™•ì¸

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-05-01 á„‹á…©á„’á…® 5.23.57.png](README.assets/endpoint.png)

- External Ip ì ìš© í™•ì¸

  ```bash
  ubuntu@ip-172-26-10-112:~$ kubectl get svc -n ingress-nginx
  NAME                                 TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                      AGE
  ingress-nginx-controller             LoadBalancer   10.101.221.124   172.26.10.112   80:30254/TCP,443:30710/TCP   30m
  ingress-nginx-controller-admission   ClusterIP      10.105.8.168     <none>          443/TCP                      30m
  ```

- HTTPS + 443í¬íŠ¸ ì ‘ì† í™•ì¸

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-05-01 á„‹á…©á„’á…® 5.25.30.png](README.assets/mainpage.png)



## 7. Jenkins-K8S ì—°ë™

### Jenkins í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

- Kubernetes Continuous Deploy í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
  - í˜„ì¬ ë²„ì „ì€ ì‚¬ìš© ë¶ˆê°€
  - 1.0.0 ë²„ì „ ë‹¤ìš´ë¡œë“œ í›„ ì§ì ‘ ì—…ë¡œë“œ í•´ì„œ ì‚¬ìš©
    - [https://velog.io/@seokbin/Jenkins-Kubernetes-ë°°í¬-with-Nexus](https://velog.io/@seokbin/Jenkins-Kubernetes-%EB%B0%B0%ED%8F%AC-with-Nexus) ì°¸ì¡°
- Kubernetes Credentials í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

### Kubernetes-Credential in Jenkins ë“±ë¡

- Global Credentialë¡œ ê´€ë¦¬

  - Kubeconfig - Enter directlyë¡œ ì„¤ì •

  - ê°’ ê°€ì ¸ì˜¤ê¸°

    - ë§ˆìŠ¤í„°ë…¸ë“œ /home/ubuntu/.kubeë¡œ ì§„ì… í›„ ë‚´ìš© í™•ì¸

    ```yaml
    ubuntu@ip-172-26-10-112:~/.kube$ cat config
    apiVersion: v1
    clusters:
    - cluster:
        certificate-authority-data: {SECRET}
        server: https://172.26.10.112:6443
      name: kubernetes
    contexts:
    - context:
        cluster: kubernetes
        user: kubernetes-admin
      name: kubernetes-admin@kubernetes
    current-context: kubernetes-admin@kubernetes
    kind: Config
    preferences: {}
    users:
    - name: kubernetes-admin
      user:
        client-certificate-data: {SECRET}
        client-key-data: {SECRET}
    ```

  - Credential ì„¤ì •

    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-05-03 á„‹á…©á„’á…® 7.25.07.png](README.assets/jenkins_credentials.png)

### íŒŒì´í”„ë¼ì¸ì— ì¶”ê°€

- Springboot - Deployment-Service ë‚´ìš© ìƒì„±

  ```yaml
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: springboot
    labels:
      app: springboot
  spec:
    replicas: 6
    selector:
      matchLabels:
        app: springboot
    template:
      metadata:
        labels:
          app: springboot
      spec:
        containers:
          - name: springboot
            image: gkuer/joalarm-springboot:latest
            ports:
              - containerPort: 8888
            imagePullPolicy: Always
            env:
              - name: MYSQL_CLUSTER_IP
                valueFrom:
                  configMapKeyRef:
                    name: joalarm-springboot-config
                    key: mysql-cluster-ip
              - name: MONGO_CLUSTER_IP
                valueFrom:
                  configMapKeyRef:
                    name: joalarm-springboot-config
                    key: mongo-cluster-ip
              - name: S3_BUCKET_NAME
                valueFrom:
                  configMapKeyRef:
                    name: joalarm-s3-config
                    key: s3-bucket-name
              - name: USERNAME
                valueFrom:
                  secretKeyRef:
                    name: joalarm-springboot-secret
                    key: username
              - name: PASSWORD
                valueFrom:
                  secretKeyRef:
                    name: joalarm-springboot-secret
                    key: password
              - name: AWS_ACCESS_KEY
                valueFrom:
                  secretKeyRef:
                    name: joalarm-s3-secret
                    key: aws-access-key
              - name: AWS_SECRET_KEY
                valueFrom:
                  secretKeyRef:
                    name: joalarm-s3-secret
                    key: aws-secret-key
              - name: JWT_SECRET_KEY
                valueFrom:
                  secretKeyRef:
                    name: joalarm-jwt-secret
                    key: jwt-secret-key
        restartPolicy: Always
  ---
  
  apiVersion: v1
  kind: Service
  metadata:
    name: service-springboot
  spec:
    selector:
      app: springboot
    ports:
      - protocol: TCP
        port: 8888
        targetPort: 8888
    type: LoadBalancer
  ```

- Springboot - Jenkinsfileì— ìŠ¤í…Œì´ì§€ ì¶”ê°€ ìƒì„±

  ```yaml
  stage('K8S Deploy') {
  
              steps {
                  dir("./backend/joalarm") {
                      script {
                          kubernetesDeploy(configs: "joalarm-auto-deploy-springboot.yaml", kubeconfigId: 'Kubeconfig')
                          sh './kubectl --kubeconfig=./kube-config.yaml rollout restart deployment springboot'
                      }
                  }
              }
          }
  ```

- React - Deployment-Service ë‚´ìš© ìƒì„±

  ```yaml
  kind: Deployment
  apiVersion: apps/v1
  metadata:
    name: react
  spec:
    replicas: 3
    selector:
      matchLabels:
        app: react
    template:
      metadata:
        labels:
          app: react
      spec:
        containers:
          - name: react
            image: gkuer/joalarm-react:latest
            ports:
              - containerPort: 80
            imagePullPolicy: Always
        restartPolicy: Always
  
  ---
  kind: Service
  apiVersion: v1
  metadata:
    name: service-react
  spec:
    type: NodePort
    ports:
      - port: 80
        targetPort: 80
        protocol: TCP
        nodePort: 31000
    selector:
      app: react
  ```

- React - Jenkinsfileì— ìŠ¤í…Œì´ì§€ ì¶”ê°€ ìƒì„±

  ```yaml
  stage('K8S Deploy') {
  
              steps {
                  dir("./frontend") {
                      script {
                          kubernetesDeploy(configs: "joalarm-auto-deploy-react.yaml", kubeconfigId: 'Kubeconfig')
  						sh './kubectl --kubeconfig=./kube-config.yaml rollout restart deployment react'
                      }
                  }
              }
          }
  ```

- íŒŒì´í”„ë¼ì¸ êµ¬ì„± ì™„ë£Œ



## 8. Rollout Restart ì¶”ê°€

- í•´ë‹¹ yaml íŒŒì¼ë¡œ Deploymentê°€ ìˆ˜ì •ë˜ì—ˆì§€ë§Œ Deploymentì˜ Rollout Restart í•„ìš”

### Springboot Deployment

- ê²½ë¡œì— ë§ì¶° kubectl ì„¤ì¹˜

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm/backend/joalarm$ curl -LO "https://storage.googleapis.com/kubernetes-release/release/v1.20.5/bin/linux/amd64/kubectl"
    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                   Dload  Upload   Total   Spent    Left  Speed
  100 38.3M  100 38.3M    0     0  25.0M      0  0:00:01  0:00:01 --:--:-- 25.0M
  ```

- ê¶Œí•œ ë³€ê²½

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm/backend/joalarm$ chmod u+x ./kubectl
  ```

- kube-config.yaml ì‘ì„±

  - ìœ„ì˜ master nodeì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë²•ê³¼ ë™ì¼

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm/backend/joalarm$ vi kube-config.yaml
  ```

  ```bash
  apiVersion: v1
  clusters:
  - cluster:
      certificate-authority-data: {SECRET}
      server: https://172.26.10.112:6443
    name: kubernetes
  contexts:
  - context:
      cluster: kubernetes
      user: kubernetes-admin
    name: kubernetes-admin@kubernetes
  current-context: kubernetes-admin@kubernetes
  kind: Config
  preferences: {}
  users:
  - name: kubernetes-admin
    user:
      client-certificate-data: {SECRET}
      client-key-data: {SECRET}
  ```

- ëª…ë ¹ì–´ ì‹œë„

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm/backend/joalarm$ ./kubectl --kubeconfig=./kube-config.yaml get deployments
  NAME         READY   UP-TO-DATE   AVAILABLE   AGE
  mongo        1/1     1            1           7d12h
  mysql        1/1     1            1           7d22h
  ```

- Jenkinsfile (Pipeline)ì— ì‰˜ ëª…ë ¹ìœ¼ë¡œ ì¶”ê°€

  ```bash
  stage('K8S Deploy') {
  
              steps {
                  dir("./backend/joalarm") {
                      script {
                          kubernetesDeploy(configs: "joalarm-auto-deploy-springboot.yaml", kubeconfigId: 'Kubeconfig')
                          sh './kubectl --kubeconfig=./kube-config.yaml rollout restart deployment springboot'
                      }
                  }
              }
          }
  ```

### React Deployment

- ê²½ë¡œì— ë§ì¶° kubectl ì„¤ì¹˜

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm-front/frontend$ curl -LO "https://storage.googleapis.com/kubernetes-release/release/v1.20.5/bin/linux/amd64/kubectl"
    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                   Dload  Upload   Total   Spent    Left  Speed
  100 38.3M  100 38.3M    0     0  25.0M      0  0:00:01  0:00:01 --:--:-- 25.0M
  ```

- ê¶Œí•œ ë³€ê²½

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm-front/frontend$ chmod u+x ./kubectl
  ```

- kube-config.yaml ì‘ì„±

  - ìœ„ì˜ master nodeì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë²•ê³¼ ë™ì¼

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm-front/frontend$ vi kube-config.yaml
  ```

  ```bash
  apiVersion: v1
  clusters:
  - cluster:
      certificate-authority-data: {SECRET}
      server: https://172.26.10.112:6443
    name: kubernetes
  contexts:
  - context:
      cluster: kubernetes
      user: kubernetes-admin
    name: kubernetes-admin@kubernetes
  current-context: kubernetes-admin@kubernetes
  kind: Config
  preferences: {}
  users:
  - name: kubernetes-admin
    user:
      client-certificate-data: {SECRET}
      client-key-data: {SECRET}
  ```

- ëª…ë ¹ì–´ ì‹œë„

  ```bash
  jenkins@2c12ec6a7d66:~/workspace/joalarm-front/frontend$ ./kubectl --kubeconfig=./kube-config.yaml rollout restart deployment react
  deployment.apps/react restarted
  ```

- Jenkinsfile (Pipeline)ì— ì‰˜ ëª…ë ¹ìœ¼ë¡œ ì¶”ê°€

  ```bash
  stage('K8S Deploy') {
  
              steps {
                  dir("./backend/joalarm") {
                      script {
                          kubernetesDeploy(configs: "joalarm-auto-deploy-springboot.yaml", kubeconfigId: 'Kubeconfig')
                          sh './kubectl --kubeconfig=./kube-config.yaml rollout restart deployment react'
                      }
                  }
              }
          }
  ```

- ì§€ì†ì  ë°°í¬ í™•ì¸

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-05-03 á„‹á…©á„’á…® 11.42.01.png](README.assets/continuous.png)

## 9. íŒ€ ë‚´ì˜ ë¹Œë“œ ìƒíƒœ ë° ë¡œê·¸ í™•ì¸ì„ ìœ„í•œ Mattermost-Jenkins ì—°ë™

### Mattermost ì„¤ì •

- Mattermost â‡’ Intergration â‡’ Incoming Webhook â‡’ ì„¤ì •

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-05-04 á„‹á…©á„Œá…¥á†« 10.31.45.png](README.assets/mattermost_config.png)

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-05-04 á„‹á…©á„Œá…¥á†« 10.32.02.png](README.assets/mattermost_url.png)

- í•´ë‹¹ URL ë³µì‚¬

### Jenkins ì„¤ì •

- í”ŒëŸ¬ê·¸ì¸ ë° ì´ˆê¸° ì…‹íŒ…

  - [https://mattermost.com/blog/getting-started-with-mattermost-integrations/](https://mattermost.com/blog/getting-started-with-mattermost-integrations/) ì°¸ì¡°

- íŒŒì´í”„ë¼ì¸ êµ¬ì„±

  ```yaml
  pipeline{
  
  	agent any
  
  	environment {
  		DOCKERHUB_CREDENTIALS=credentials('dockerhub')
  	}
  
  	stages {
  
  		stage('Build') {
  
  			steps {
  			    dir("./backend/joalarm") {
  			        script {
  			            mattermostSend(color: "#FFFF8C", message: "Jenkins - ${env.BUILD_NUMBER}ë²ˆì§¸ Backend ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ ì‹œì‘")
  			            try {
                              sh 'chmod +x ./gradlew'
                              sh './gradlew clean build'
                              sh 'docker build --build-arg ENVIRONMENT=dev -t gkuer/joalarm-springboot .'
                              mattermostSend(color: "#FF33FF", message: "Jenkins - ${env.BUILD_NUMBER}ë²ˆì§¸ Backend ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ ì™„ë£Œ")
                          } catch(e) {
                              mattermostSend(color: "#FF33FF", message: "Jenkins - ${env.BUILD_NUMBER}ë²ˆì§¸ Backend ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ ì‹¤íŒ¨ => ë¡œê·¸ í™•ì¸ : ${env.BUILD_URL}")
                          }
                      }
  			    }
  			}
  		}
  
  		stage('Login') {
  
  			steps {
  				sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
  			}
  		}
  
  		stage('Push') {
  
  			steps {
  				sh 'docker push gkuer/joalarm-springboot'
  				mattermostSend(color: "#33FFCC", message: "Dockerhub - ${env.BUILD_NUMBER}ë²ˆì§¸ Backend í‘¸ì‰¬ ì™„ë£Œ")
  			}
  		}
  
          stage('K8S Deploy') {
  
              steps {
                  dir("./backend/joalarm") {
                      script {
                          kubernetesDeploy(configs: "joalarm-auto-deploy-springboot.yaml", kubeconfigId: 'Kubeconfig')
                          sh './kubectl --kubeconfig=./kube-config.yaml rollout restart deployment springboot'
                          mattermostSend(color: "#0066CC", message: "Kubernetes - ${env.BUILD_NUMBER}ë²ˆì§¸ Backend ë°°í¬ ì™„ë£Œ")
                      }
                  }
              }
          }
  	}
  
  	post {
  		always {
  			sh 'docker logout'
  		}
  	}
  
  }
  ```

- ë¡œê·¸ í™•ì¸

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-05-04 á„‹á…©á„’á…® 4.48.24.png](README.assets/mattermost_result.png)
